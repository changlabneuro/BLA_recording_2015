---
title: "Supplementary Information: Models"
author: "Steve Chang et al."
date: "10/20/2015"
output: pdf_document
---

# Hierarchical models for spike counts

## Model 1

Here, we model spike counts in the time window of interest as drawn from a Poisson distribution:
$$
\begin{aligned}
N_i &\sim \mathrm{Poisson}(\lambda_i) \\
\lambda_i &= \beta_{0 cu} + \beta_{1cu} R_i + \beta_{2cu} \tau_i 
  + \beta_{3cu} R_i \tau_i \\
  \beta_{j \cdot u} &\sim \mathrm{Normal}(\mu_{j}, \Sigma_j) \\
  (\mu_j, \Sigma_j) &\sim \text{Normal-Inverse-Wishart}(\mu_{0j}, \lambda_j, \Psi_j, \nu_j)
\end{aligned}
$$
with $N_i$ the spike count on trial $i$, $c(i)$ and $u(i)$ the choice (outcome type) and unit for that trial, $R_i$ the reward on the trial (coded as a percent of maximum) and $\tau_i$ the trial type (cued vs free choice). 

In other words, we model the regression coefficients for each unit as drawn from multivariate normal distributions with mean $\mu$ and covariance $\Sigma$, and we are particularly interested in inferring these parameters for the entire population of cells.

# To do:
- effects of cuing in model
- density plot of posteriors with units on top (via generated quantities in stan?)
- are the same cells outliers in successive time periods?

# Further models
- model social decision as a function of spike counts (how to quantify performance on held-out data?)
- quantify OT effects
    - on choice
    - on gaze

# Bullpen
- non-additive trial type effects (cued vs choice treated as unrelated?)
- ~~negative binomial or added gaussian in linear predictor~~ seems unnecessary given low spike counts
- model of separate subpopulations:
    - three groups:
        - negative tuning
        - positive tuning
        - noise (with mean constrained to 0 and perhaps diagonal $\Sigma$?; isotropic, even?)

